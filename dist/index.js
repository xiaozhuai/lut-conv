var I=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var S=(c,t)=>{for(var n in t)I(c,n,{get:t[n],enumerable:!0})},U=(c,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of k(t))!D.call(c,e)&&e!==n&&I(c,e,{get:()=>t[e],enumerable:!(o=$(t,e))||o.enumerable});return c};var _=c=>U(I({},"__esModule",{value:!0}),c);var W={};S(W,{LutConv:()=>z,LutData:()=>x});module.exports=_(W);function m(c,t,n){return Math.max(t,Math.min(n,c))}function p(c,t,n){return c+n*(t-c)}var x=class c{width;height;depth;data;constructor(t,n,o,e=null){if(this.width=t,this.height=n,this.depth=o,e===null)this.data=new Float32Array(t*n*o*3);else{if(e.length!==t*n*o*3)throw new Error("Invalid data length");this.data=e}}get(t,n,o){let e=(o*this.width*this.height+n*this.width+t)*3;return this.data.subarray(e,e+3)}set(t,n,o,e){let r=(o*this.width*this.height+n*this.width+t)*3;this.data[r]=e[0],this.data[r+1]=e[1],this.data[r+2]=e[2]}lookup(t,n,o,e){switch(e){case"nearest":return this.lookupNearest(t,n,o);case"linear":return this.lookupLinear(t,n,o);default:throw new Error("Invalid filter mode")}}lookupNearest(t,n,o){let e=t*this.width-.5,r=n*this.height-.5,i=o*this.depth-.5,s=m(Math.round(e),0,this.width-1),h=m(Math.round(r),0,this.width-1),l=m(Math.round(i),0,this.width-1);return this.get(s,h,l)}lookupLinear(t,n,o){let e=t*this.width-.5,r=n*this.height-.5,i=o*this.depth-.5,s=m(Math.floor(e),0,this.width-1),h=m(Math.floor(r),0,this.height-1),l=m(Math.floor(i),0,this.depth-1),a=m(s+1,0,this.width-1),u=m(h+1,0,this.height-1),d=m(l+1,0,this.depth-1),f=this.get(s,h,l),w=this.get(s,h,d),y=this.get(s,u,l),F=this.get(s,u,d),g=this.get(a,h,l),v=this.get(a,h,d),M=this.get(a,u,l),A=this.get(a,u,d),E=e-s,L=r-h,C=i-l;return new Float32Array(3).map((H,b)=>p(p(p(f[b],g[b],E),p(y[b],M[b],E),L),p(p(w[b],v[b],E),p(F[b],A[b],E),L),C))}resize(t,n,o,e){let r=new c(t,n,o);for(let i=0;i<o;i++)for(let s=0;s<n;s++)for(let h=0;h<t;h++){let l=(h+.5)/t,a=(s+.5)/n,u=(i+.5)/o;r.set(h,s,i,this.lookup(l,a,u,e))}return r}},z=class{static loadCubeStr(t){let n=/^LUT_3D_SIZE (\d+)$/m,o=/^([\d\\.Ee-]+) ([\d\\.Ee-]+) ([\d\\.Ee-]+)$/,e=n.exec(t);if(!e||e.length<2)throw new Error("Error parsing cube");let r=parseInt(e[1]),i=t.replace(/\r/g,"").split(`
`),s=0;for(;!o.test(i[s]);)s++;i.splice(0,s),i.splice(r*r*r);let h=new Float32Array(r*r*r*3);return i.forEach((l,a)=>{let u=l.split(" ").map(parseFloat);h[a*3]=u[0],h[a*3+1]=u[1],h[a*3+2]=u[2]}),new x(r,r,r,h)}static saveCubeStr(t,n=""){let o=`${n.trim()}
LUT_3D_SIZE ${t.width}

`;for(let e=0;e<t.depth;e++)for(let r=0;r<t.height;r++)for(let i=0;i<t.width;i++){let s=t.get(i,r,e);o+=`${s[0].toFixed(6)} ${s[1].toFixed(6)} ${s[2].toFixed(6)}
`}return o}static loadLutImageData(t,n){let{imageWidth:o,imageHeight:e,width:r,height:i,depth:s}=n;if(o%r!==0||e%i!==0)throw new Error("Invalid image size");let h=o/r,l=new x(r,i,s);for(let a=0;a<s;a++)for(let u=0;u<i;u++)for(let d=0;d<r;d++){let f=a%h,w=Math.floor(a/h),y=d+f*r,g=((u+w*i)*o+y)*4;l.set(d,u,a,new Float32Array([t[g]/255,t[g+1]/255,t[g+2]/255]))}return l}static saveLutImageData(t,n){let{imageWidth:o,imageHeight:e,width:r,height:i,depth:s}=n;if(o%r!==0||e%i!==0)throw new Error("Invalid image size");if(t.width!==r||t.height!==i||t.depth!==s)throw new Error("Invalid lut size");let h=o/r,l=new Uint8ClampedArray(o*e*4);for(let a=0;a<s;a++)for(let u=0;u<i;u++)for(let d=0;d<r;d++){let f=a%h,w=Math.floor(a/h),y=d+f*r,g=((u+w*i)*o+y)*4,v=t.get(d,u,a);l[g]=m(Math.round(v[0]*255),0,255),l[g+1]=m(Math.round(v[1]*255),0,255),l[g+2]=m(Math.round(v[2]*255),0,255),l[g+3]=255}return l}};0&&(module.exports={LutConv,LutData});
//# sourceMappingURL=index.js.map